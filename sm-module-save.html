<html><head><meta charset="UTF-8"><link rel="import" href="../sm-utility-auth/sm-utility-auth.html"><link rel="import" href="../sm-ui-callout/sm-ui-callout.html"><link rel="import" href="../sm-ui-button/sm-ui-button.html"><link rel="import" href="../simpla-core/simpla-core.html"><link rel="import" href="../polymer/polymer.html"></head><body><dom-module id="sm-module-save"> <template> <style include="sm-css-shady"></style><style include="sm-css"></style><style>:root{--arrow-size:12px}:host{@apply(--typography);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:end;-webkit-align-items:flex-end;-ms-flex-align:end;align-items:flex-end;border-radius:var(--border-radius);z-index:var(--on-top);overflow:visible}.controls{position:relative;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;background:var(--blue);border-radius:var(--border-radius);color:#fff;box-shadow:0 1px 2px var(--light-black);z-index:1}.controls__save{padding:0 1.5em;font-weight:600}.controls__save[busy]{color:var(--med-white)}.controls__menu{--icon-size:21px;width:var(--tool-size);border-left:1px solid var(--light-white)}.menu{top:16px;right:3px;display:none;-webkit-transform-origin:top right;transform-origin:top right}.menu[visible]{display:block}.menu__item{font-size:14px;padding:0 15px;font-weight:600;color:var(--dark-gray)}</style><div class="controls"> <button is="sm-ui-button" on-tap="save" busy="[[busy]]" class="controls__save">save</button> <button is="sm-ui-button" on-tap="toggleMenu" class="controls__menu" icon="[[_menuIcon]]"></button> </div> <sm-ui-callout arrow="top right" class="menu" id="menu" active="[[_menuActive]]"> <template is="dom-repeat" items="[[menu]]"> <button is="sm-ui-button" id="[[item.id]]" class="menu__item" icon="[[item.icon]]" on-tap="_menuItemTap">[[item.text]]</button> </template> </sm-ui-callout> <sm-utility-auth id="auth"></sm-utility-auth> </template> <script>!function(){"use strict";function e(){return simpla.notifications?simpla.notifications.notify.bind(simpla.notifications):function(e,n,t){console.info(t+": "+n)}}var n={};n.classCallCheck=function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")},n.createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}();var t={success:{type:"success",title:"Saved",message:"Hooray! Your changes are published"},warn:{type:"warning",title:"Uhhhh",message:"Looks like some things didn't save properly. Try again"},error:{type:"error",title:"Save Failed",message:"Oh no! Something went wrong, check your internet connection and try again"}},i={listeners:{saved:"_notifySuccess","save-failed":"_notifyFailed"},_notify:function(n){var t=e();t(n.type,n.message,n.title)},_notifySuccess:function(){this._notify(t.success)},_notifyFailed:function(e){var n=e.detail;this._notify(n.all?t.error:t.warn)}},o={properties:{menu:{type:Array,value:[{id:"logout",text:"Logout",icon:"simpla:exit",onTap:"_logout"}]},_menuActive:Boolean,_menuIcon:{type:String,computed:"_computeMenuIcon(_menuActive)",value:"simpla:arrow-down"}},toggleMenu:function(){this._menuActive=!this._menuActive},_computeMenuIcon:function(e){var n=void 0;return n=e?"simpla:arrow-up":"simpla:arrow-down"},_menuItemTap:function(e){var n=e.model;n&&"function"==typeof this[n.item.onTap]&&this[n.item.onTap](e),this._menuActive=!1},_logout:function(){this.$.auth.logout()}},s=function(){function e(){n.classCallCheck(this,e)}return n.createClass(e,[{key:"beforeRegister",value:function(){this.is="sm-module-save",this.properties={busy:Boolean},this.listeners={saving:"_beBusy",saved:"_stopBusy"}}},{key:"save",value:function(){var e=this,n=0,t=0,i=0,o=!1,s=void 0;this.fire("saving"),s=function(){0===i?e.fire("saved"):e.fire("save-failed",{all:0===t})},simpla.elements.forEach(function(e){var a=void 0,r=void 0,u=function(){return r(!0)},c=function(){return r(!1)};a=function(){n++,e.addEventListener("saved",u),e.addEventListener("error",c)},r=function(a){n--,e.removeEventListener("saved",u),e.removeEventListener("error",c),a?t++:i++,0===n&&o&&s()},e.save()&&a()}),o=!0}},{key:"_beBusy",value:function(){this.busy=!0}},{key:"_stopBusy",value:function(){this.busy=!1}},{key:"behaviors",get:function(){return[o,i]}}]),e}();Polymer(s)}();</script></dom-module></body></html>